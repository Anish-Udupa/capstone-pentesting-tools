import openai
import json
class GenAi:
    def reader(self,outputfile):#txt file name containing output eg : "sample_ouput.txt"
        with open(outputfile,newline="") as lines:
            data="\n".join(lines)
        return data
    def get(self,query,outputfile):
        data=reader(self,outputfile)
        response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": "You are a pentration tester, who uses pentration testing tools and based on their outputs answer the questions"+data},
            {"role": "user", "content": query+". Return this in JSON format."}
        ]
    )
        answer=response["choices"][0]["message"]["content"]
        while(response["choices"][0]["finish_reason"]=='length'):
            response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "You are a pentration tester, who uses pentration testing tools and based on their outputs answer the questions"+data},
                {"role": "user", "content":query  },
                {"role":"assistant","content":response["choices"][0]["message"]["content"][-100:]},
                {"role":"user","content":"Finish the json string from where you stopped for the previous query"}
            ]
        )
            answer+=response["choices"][0]["message"]["content"]
        return json.loads(answer)
# Sample usage
api_key = "your_key"
openai.api_key = api_key
ob=GenAi()
d=ob.get("State the database name and version","sqlmap_sample.txt")
print(d)

