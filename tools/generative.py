import openai
import json
import ast
class GenAi:
    def __init__(self):
        api_key = "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"
        openai.api_key = api_key

    def get(self,query,return_format,data):
        try:
            c="You are a pentration tester, who uses pentration testing tools and based on their outputs answer the questions"+data
            a=query+". Return this in "+ return_format+" format. Do notadd any additional data"
            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=[
                    {"role": "system", "content": c},
                    {"role": "user", "content":a }
                ]
            )
            answer=response["choices"][0]["message"]["content"]
            # print(response)
            # print("ans:")
            # print(answer)
            while(response["choices"][0]["finish_reason"]=='length'):
                response = openai.ChatCompletion.create(
                    model="gpt-3.5-turbo",
                    messages=[
                        {"role": "system", "content": "You are a pentration tester, who uses pentration testing tools and based on their outputs answer the questions"+data},
                        {"role": "user", "content":query +" format: "+return_format },
                        {"role":"assistant","content":response["choices"][0]["message"]["content"][-100:]},
                        {"role":"user","content":"Finish the response from where you stopped for the previous query"}
                    ]
                )                
                answer+=response["choices"][0]["message"]["content"]
        # except InvalidRequestError:
        except Exception as e:
            print(e)
            answer="[]"
        finally:
            return answer
