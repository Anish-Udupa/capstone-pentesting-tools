from .util import run_command
from .generative import GenAi
import ast
class gospider:
    def __init__(self, ip):
        self.ip = ip
        self.urls=[]
        self.genai=GenAi()

    def extract_features(self,data):
        query="Return a list of urls"
        return_format="['url1,url2,'...]"
        soln=self.genai.get(query,return_format,data)
        soln=ast.literal_eval(soln)
        if len(soln)>0:
            self.urls=soln
            return True
        else:
            return False
        
    def get_urls(self):
        return self.urls
    
    def run(self):
        cmd = f"gospider -d 0 -s http://{self.ip}"
        result = run_command(cmd)
        print(result)

        features_success = False
        if result['status'] == 'success':
            features_success = self.extract_features(result['output'])
            
        if features_success is True:
            result['status'] = 'Success'
        else:
            result['status'] = 'failure'
        return result
