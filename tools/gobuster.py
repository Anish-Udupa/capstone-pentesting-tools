from .util import run_command
import re
from .generative import GenAi
import ast
class gobuster:
    def __init__(self, ip, wordlist="/usr/share/wordlists/dirb/small.txt"):
        self.ip = ip
        self.wordlist = wordlist
        self.directories = []
        self.genai=GenAi()
    def extract_features(self,data):
        query="Return a list of directories"
        return_format="['directory_name1',directory_name2'...]"
        soln=self.genai.get(query,return_format,data)
        soln=ast.literal_eval(soln)
        if len(soln)>0:
            self.directories=soln
            return True
        else:
            return False
    def run(self):
        cmd = f"gobuster dir -w {self.wordlist} -u http://{self.ip}/"
        result = run_command(cmd)
        print(result)
        output = result['output']

        re_pattern_directory = f"http://{self.ip}*"
        directories = re.findall(re_pattern_directory, output)
        self.directories = re_pattern_directory
        print("Directories:", directories)
        return output
