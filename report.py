import pdfkit
import datetime

class Report:
    def __init__(self, ip):
        self.file = open("./report/report.html", "w")
        self.opening_string = "<html>\n<head>\n<Link rel='stylesheet' href='report.css' />\n</head>\n<body>\n" + \
        f"<h1 id=\"title\">Pentest Report for {ip}</h1>\n" + \
        "<h2>Disclaimer</h2>\n" + \
        f"<p>The following is a computer generated report of a penetration test performed on the following host: {ip}. " + \
        f"We expect the the client who requested the pentest owns the machine to be pentested. In case of any violation, we (the company performing the pentest) are not liable. " + \
        f"In case no vulnerabilities are found, it does not mean that no vulnerabilities are present. There is no such concept as 100% secure machine. " + \
        f"New vulnerabilities are being found everyday.</p>\n<br />\n"

        self.closing_string = f"<p><b>Date timestamp:</b> {datetime.datetime.now()}</p>\n</body>\n</html>"
        self.file.write(self.opening_string)


    def save(self):
        self.file.write(self.closing_string)
        self.file.close()
        pdfkit.from_file("./report/report.html", "./report/report.pdf", options={"enable-local-file-access": True})
    
    def write_tool_output(self, tool_name, tool_output, tool_feature_output=""):
        self.file.write(f"<h2>{tool_name}</h2>\n")
        replaced_tool_output = tool_output.replace("\n", "<br />\n")
        self.file.write(f"<p class=\"tool-output\">{replaced_tool_output}</p>\n")
        self.file.write(f"<br />")
        self.file.write(f"<h4>Features extracted using GenAI</h4>")
        self.file.write(f"<p>{tool_feature_output}</p>")
        self.file.write(f"<br />")
